<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxia de Amor con Saturno ü™êüíñ</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FontLoader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/geometries/TextGeometry.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            overflow: hidden; 
            font-family: 'Arial', sans-serif; 
            background: radial-gradient(ellipse at bottom, #0a0e1a 0%, #000000 100%);
            color: white; 
            height: 100vh; 
            width: 100vw; 
            position: relative; 
        }
        h2{
            color: #ff69b4;
            font-size: 1.5rem;
        }
        .cielo {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .estrella {
            position: absolute;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 2px white;
            animation: centellear var(--duracion) infinite alternate ease-in-out var(--retraso);
            z-index: 0;
        }

        @keyframes centellear {
            0%, 100% { opacity: 0.5; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .luna {
            position: absolute;
            top: 10%;
            right: 5%;
            width: 150px;
            height: 150px;
            background: #f0f0f0;
            border-radius: 50%;
            box-shadow: 
                0 0 50px rgba(255, 255, 255, 0.4), 
                inset -15px -15px 40px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(255, 255, 255, 0.3);
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        #contenedor-escena { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 1; 
            background: transparent;
        }

        #superposicion-ui { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 10; 
            pointer-events: none; 
        }

        #instrucciones { 
            position: absolute; 
            bottom: 20px; 
            left: 0; 
            width: 100%; 
            text-align: center; 
            font-size: 16px; 
            padding: 12px; 
            animation: pulso 3s infinite; 
            background: rgba(0, 0, 0, 0.4); 
            backdrop-filter: blur(5px); 
            z-index: 15;
            pointer-events: none;
        }

        @keyframes pulso { 
            0% { opacity: 0.7; } 
            50% { opacity: 1; } 
            100% { opacity: 0.7; } 
        }

        .corazon { 
            position: absolute; 
            font-size: 22px; 
            color: #ff69b4; 
            z-index: 5; 
            pointer-events: none; 
            animation: caer linear forwards; 
            text-shadow: 0 0 8px #ff1493; 
        }

        @keyframes caer { 
            to { 
                transform: translateY(100vh) rotate(360deg); 
                opacity: 0; 
            } 
        }

        #indicador-toque { 
            position: absolute; 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            background: radial-gradient(circle, rgba(255,105,180,0.7) 0%, rgba(255,20,147,0) 70%); 
            pointer-events: none; 
            z-index: 20; 
            opacity: 0; 
            transform: translate(-50%, -50%); 
            transition: opacity 0.3s;
        }

        /* --- Cargador --- */
        #cargando { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            font-size: 22px; 
            z-index: 100; 
            background: radial-gradient(circle at center, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            backdrop-filter: blur(5px);
            color: #fff;
        }

        .contenido-cargando {
            background: rgba(0, 0, 0, 0.6);
            padding: 30px 50px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 0 30px rgba(100, 149, 237, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cargador-reloj {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            position: relative;
            margin: 20px auto;
            /* Usamos la variable CSS --progreso, que el JS actualizar√° */
            background: conic-gradient(#ff69b4 0%, #ff69b4 var(--progreso, 0%), #4a4a8a var(--progreso, 0%), #4a4a8a 100%); 
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
        }

        .cargador-reloj::before {
            content: '';
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: #1a1a2e;
        }

        .manecilla-reloj {
            position: absolute;
            width: 3px;
            height: 30px;
            background: #ff69b4;
            top: 10px;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(0deg);
            box-shadow: 0 0 5px #ff69b4;
            z-index: 1;
            animation: rotar-reloj 2s linear infinite;
        }

        @keyframes rotar-reloj {
            0% { transform: translateX(-50%) rotate(0deg); }
            100% { transform: translateX(-50%) rotate(360deg); }
        }

        .centro-reloj {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ff69b4;
            z-index: 2;
            box-shadow: 0 0 10px #ff69b4;
        }

        .texto-progreso {
            margin-top: 10px;
            font-size: 18px;
            color: #ff69b4;
            text-shadow: 0 0 5px rgba(255, 105, 180, 0.7);
        }

        #puntos-cargando { animation: puntos 1.5s infinite; }
        @keyframes puntos { 0%, 20% { content: "."; } 40% { content: ".."; } 60%, 100% { content: "..."; } }

        /* --- Galer√≠a --- */
        .galeria { 
            position: absolute; 
            bottom: 80px; 
            left: 0; 
            width: 100%; 
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            padding: 0 10px; 
            z-index: 15; 
            pointer-events: auto; 
        }

        .elemento-galeria { 
            width: 70px; 
            height: 70px; 
            border-radius: 10px; 
            overflow: hidden; 
            cursor: pointer; 
            border: 2px solid rgba(255, 255, 255, 0.3); 
            transition: all 0.3s ease; 
            background: rgba(0, 0, 0, 0.5); 
            backdrop-filter: blur(5px); 
        }

        .elemento-galeria:hover { 
            transform: scale(1.1); 
            border-color: #ff69b4; 
        }

        .elemento-galeria img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }

        /* --- Modal --- */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.9); 
            z-index: 100; 
            justify-content: center; 
            align-items: center; 
            pointer-events: auto;
        }

        .contenido-modal { 
            max-width: 90%; 
            max-height: 80%; 
            border-radius: 15px; 
            box-shadow: 0 0 50px rgba(255, 105, 180, 0.5); 
            position: relative;
            display: block;
            object-fit: contain; /* Asegura que la imagen se ajuste */
        }
        
        .contenido-modal-contenedor {
            max-width: 90%; 
            max-height: 80%;
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(255, 105, 180, 0.5); 
        }

        .contenido-modal-contenedor img {
            display: block;
            width: auto;
            max-width: 100%;
            height: auto;
            max-height: 100%;
        }

        .mensaje-modal { 
            position: absolute; 
            bottom: 0; 
            left: 0; 
            width: 100%; 
            text-align: center; 
            font-size: 20px; 
            color: #ff69b4; 
            text-shadow: 0 0 10px #ff1493; 
            padding: 15px; 
            background: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(10px); 
        }

        .boton-cerrar { 
            position: absolute; 
            top: 20px; 
            right: 30px; 
            font-size: 40px; 
            color: white; 
            cursor: pointer; 
            z-index: 102; 
        }

        /* --- Audio Button --- */
        #alternar-audio { 
            position: absolute; 
            top: 15px; 
            right: 15px; 
            background: rgba(255, 255, 255, 0.15); 
            border: 1px solid rgba(255, 255, 255, 0.25); 
            color: white; 
            padding: 8px 12px; 
            border-radius: 20px; 
            cursor: pointer; 
            z-index: 15; 
            font-size: 14px; 
            backdrop-filter: blur(10px); 
            pointer-events: auto; 
            transition: all 0.3s ease; 
            opacity: 0.8; 
        }

        #alternar-audio:hover { 
            opacity: 1; 
            background: rgba(255, 255, 255, 0.25); 
        }

        /* --- Media Queries --- */
        @media (min-width: 768px) { 
            .contenido-modal-contenedor { 
                min-width: 25% ;
                min-height: 25%; 
            }
        }
        @media (max-width: 768px) { 
            .galeria { bottom: 70px; gap: 5px; }
            .elemento-galeria { width: 60px; height: 60px; }
            #instrucciones { font-size: 14px; padding: 10px; bottom: 10px; }
            .luna { width: 100px; height: 100px; }
            .contenido-modal-contenedor { max-width: 95%; max-height: 70%; }
            .mensaje-modal { font-size: 18px; padding: 10px; }
        }

        @media (max-width: 480px) {
            .galeria { bottom: 60px; }
            .elemento-galeria { width: 50px; height: 50px; }
            .mensaje-modal { font-size: 16px; padding: 8px; }
            .luna { width: 70px; height: 70px; }
        }
    </style>
</head>
<body>

    <div class="cielo" id="cielo-estrellas">
        <div class="luna"></div>
    </div>

    <div id="cargando">
        <div class="contenido-cargando">
            <h2> Preparando todo para ti, mi amor<span id="puntos-cargando">...</span></h2>
            <div class="cargador-reloj" id="cargador-reloj">
                <div class="manecilla-reloj"></div>
                <div class="centro-reloj"></div>
            </div>
            <div class="texto-progreso" id="texto-progreso">0%</div>
        </div>
    </div>
    
    <div id="contenedor-escena"></div>
    
    <div id="superposicion-ui">
        <button id="alternar-audio">OFF</button>
        <div id="indicador-toque"></div>
        <div id="instrucciones">Toca la pantalla mi amor ‚ù§Ô∏è </div>
        
        <div class="galeria" id="galeria-imagenes">
            <div class="elemento-galeria" data-indice="0"><img src="https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/GIF/gatito.gif" alt="Amor 1"></div>
            <div class="elemento-galeria" data-indice="1"><img src="https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/GIF/img.gif" alt="Amor 2"></div>
            <div class="elemento-galeria" data-indice="2"><img src="https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/GIF/Gatitosi.gif" alt="Amor 3"></div>
            <div class="elemento-galeria" data-indice="3"><img src="https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/GIF/Gatito1.gif" alt="Amor 4"></div>
        </div>
    </div>

    <div id="modal-imagen" class="modal">
        <span class="boton-cerrar">&times;</span>
        <div class="contenido-modal-contenedor">
            <img class="contenido-modal" id="imagen-modal">
            <div class="mensaje-modal" id="mensaje-modal"></div>
        </div>
    </div>

    <audio id="audio-fondo" loop>
        <source src="https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/AUDIO/en%20saturno.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- CONFIGURACI√ìN GLOBAL ---
        let scene, camera, renderer, controls;
        let saturno, anillo, texto3D, cajaTexto;
        let raycaster, mouse;
        let isLoaded = false;
        let audio, audioContext, track, volumeGain;
        let isAudioPlaying = false;
        const textureLoader = new THREE.TextureLoader();
        const clock = new THREE.Clock();

        // --- MODELO Y MENSAJES ---
        const CONFIG = {
            radioSaturno: 5,
            segmentos: 50,
            velocidadRotacion: 0.005,
            mensaje: "Te amo, mi universo entero ‚ù§Ô∏è",
            mensajesGaleria: [
                "Nuestro primer d√≠a fue el mejor. ¬°Te amo!",
                "Siempre a tu lado, en cualquier galaxia. Eres mi estrella.",
                "Cada momento contigo es un regalo. Eres mi persona favorita.",
                "Juntos, haremos que este amor sea eterno. ¬°Feliz vida juntos!"
            ],
            // Texturas de anillos y planeta (usamos URLs de Three.js para asegurar que carguen)
            texturaSaturno: "https://threejs.org/examples/textures/planets/saturnmap.jpg",
            texturaAnillo: "https://threejs.org/examples/textures/planets/saturnringcolor.jpg",
        };

        // --- INICIALIZACI√ìN DE THREE.JS ---

        function init() {
            // Escena
            scene = new THREE.Scene();
            
            // C√°mara
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 15);

            // Renderer
            const contenedor = document.getElementById('contenedor-escena');
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            contenedor.appendChild(renderer.domElement);
            
            // Controles Orbitales
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; 
            controls.dampingFactor = 0.05;
            controls.minDistance = 10;
            controls.maxDistance = 50;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.2;

            // Luces
            const luzAmbiente = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(luzAmbiente);
            
            const luzSolar = new THREE.DirectionalLight(0xffffff, 2.5);
            luzSolar.position.set(5, 5, 5).normalize();
            scene.add(luzSolar);

            // Raycaster para interacciones
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Cargar assets y empezar la escena
            loadAssets();
            crearEstrellasCSS();
            setupEventListeners();
        }

        // --- CARGA DE MODELOS Y TEXTURAS ---

        function loadAssets() {
            const manager = new THREE.LoadingManager();
            const cargadorHTML = document.getElementById('cargando');
            const progresoTexto = document.getElementById('texto-progreso');
            const cargadorReloj = document.getElementById('cargador-reloj');

            manager.onProgress = (url, itemsLoaded, itemsTotal) => {
                const progreso = Math.round((itemsLoaded / itemsTotal) * 100);
                progresoTexto.textContent = `${progreso}%`;
                cargadorReloj.style.setProperty('--progreso', `${progreso}%`);
            };

            manager.onLoad = () => {
                cargadorHTML.style.display = 'none';
                isLoaded = true;
                animate();
                document.getElementById('instrucciones').style.opacity = '1';
                controls.autoRotate = true; 
            };

            manager.onError = (url) => {
                console.error('Hubo un error cargando el asset: ' + url);
                progresoTexto.textContent = 'Error al cargar';
            };

            const assets = [
                { type: 'texture', path: CONFIG.texturaSaturno, onComplete: crearSaturno },
                { type: 'texture', path: CONFIG.texturaAnillo, onComplete: crearAnillo },
                { type: 'font', path: 'https://cdn.jsdelivr.net/npm/three@0.128.0/examples/fonts/helvetiker_regular.typeface.json', onComplete: crearTexto },
            ];

            let itemsTotal = assets.length;
            let itemsLoaded = 0;

            assets.forEach(asset => {
                if (asset.type === 'texture') {
                    textureLoader.load(asset.path, (texture) => {
                        asset.onComplete(texture);
                        itemsLoaded++;
                        manager.onProgress(asset.path, itemsLoaded, itemsTotal);
                    }, undefined, manager.onError);
                } else if (asset.type === 'font') {
                    const fontLoader = new THREE.FontLoader(manager);
                    fontLoader.load(asset.path, (font) => {
                        asset.onComplete(font);
                        itemsLoaded++;
                        manager.onProgress(asset.path, itemsLoaded, itemsTotal);
                    }, undefined, manager.onError);
                }
            });
        }

        // --- CREACI√ìN DE OBJETOS 3D ---

        function crearSaturno(texture) {
            const geometria = new THREE.SphereGeometry(CONFIG.radioSaturno, CONFIG.segmentos, CONFIG.segmentos);
            const material = new THREE.MeshPhongMaterial({ map: texture });
            saturno = new THREE.Mesh(geometria, material);
            scene.add(saturno);
        }

        function crearAnillo(texture) {
            const innerRadius = CONFIG.radioSaturno * 1.2;
            const outerRadius = CONFIG.radioSaturno * 2.5;
            const thetaSegments = 100;
            const geometry = new THREE.RingGeometry(innerRadius, outerRadius, thetaSegments);

            // Ajustar UVs (Necesario para el mapeo correcto de la textura del anillo)
            const pos = geometry.attributes.position;
            const uv = geometry.attributes.uv;
            for (let i = 0; i < pos.count; i++) {
                const x = pos.getX(i);
                const y = pos.getY(i);
                const dist = Math.sqrt(x * x + y * y);
                const v = (dist - innerRadius) / (outerRadius - innerRadius);
                const u = uv.getX(i); 
                uv.setXY(i, u, v);
            }
            geometry.attributes.uv.needsUpdate = true;

            const material = new THREE.MeshBasicMaterial({
                map: texture,
                side: THREE.DoubleSide,
                transparent: true,
                alphaTest: 0.1 
            });

            anillo = new THREE.Mesh(geometry, material);
            anillo.rotation.x = Math.PI / 2; 
            scene.add(anillo);
        }

        function crearTexto(font) {
            const textGeometry = new THREE.TextGeometry(CONFIG.mensaje, {
                font: font,
                size: 0.8,
                height: 0.1,
                curveSegments: 5,
                bevelEnabled: true,
                bevelThickness: 0.05,
                bevelSize: 0.02,
                bevelOffset: 0,
                bevelSegments: 4
            });

            const textMaterial = new THREE.MeshPhongMaterial({ color: 0xff69b4, shininess: 100 });
            texto3D = new THREE.Mesh(textGeometry, textMaterial);
            
            // Centrar el texto
            textGeometry.computeBoundingBox();
            const boundingBox = textGeometry.boundingBox;
            const centerOffset = new THREE.Vector3();
            boundingBox.getCenter(centerOffset);
            
            texto3D.position.x = -centerOffset.x;
            texto3D.position.y = 8;
            texto3D.position.z = 0;

            // Crear una caja invisible para hacer el texto clickable
            const boxGeometry = new THREE.BoxGeometry(boundingBox.max.x - boundingBox.min.x + 1, boundingBox.max.y - boundingBox.min.y + 1, 1);
            const boxMaterial = new THREE.MeshBasicMaterial({ transparent: true, opacity: 0, depthWrite: false });
            cajaTexto = new THREE.Mesh(boxGeometry, boxMaterial);
            cajaTexto.position.copy(texto3D.position);
            cajaTexto.userData.isClickableText = true;

            const grupoTexto = new THREE.Group();
            grupoTexto.add(texto3D);
            grupoTexto.add(cajaTexto);
            scene.add(grupoTexto);
        }

        // --- ANIMACI√ìN ---

        function animate() {
            requestAnimationFrame(animate);

            if (isLoaded) {
                const delta = clock.getDelta();

                if (saturno) saturno.rotation.y += CONFIG.velocidadRotacion * delta * 60;
                if (anillo) anillo.rotation.z += CONFIG.velocidadRotacion * delta * 60;
                
                // Animaci√≥n de 'flotaci√≥n' del texto
                if (texto3D) {
                    const time = Date.now() * 0.0005;
                    const floatSpeed = 0.5;
                    texto3D.parent.position.y = Math.sin(time) * floatSpeed;
                }

                controls.update(); 
                renderer.render(scene, camera);
            }
        }

        // --- ESTRELLAS CSS (Para el fondo) ---

        function crearEstrellasCSS() {
            const cielo = document.getElementById('cielo-estrellas');
            const numEstrellas = 150;

            for (let i = 0; i < numEstrellas; i++) {
                const estrella = document.createElement('div');
                estrella.classList.add('estrella');
                
                const size = Math.random() * 2 + 1; 
                estrella.style.width = `${size}px`;
                estrella.style.height = `${size}px`;
                estrella.style.top = `${Math.random() * 100}%`;
                estrella.style.left = `${Math.random() * 100}%`;

                estrella.style.setProperty('--duracion', `${Math.random() * 4 + 2}s`); 
                estrella.style.setProperty('--retraso', `${Math.random() * 2}s`); 
                
                cielo.appendChild(estrella);
            }
        }

        // --- AUDIO Y CONTROLES ---

        function setupAudio() {
            audio = document.getElementById('audio-fondo');
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            track = audioContext.createMediaElementSource(audio);
            volumeGain = audioContext.createGain();
            
            track.connect(volumeGain);
            volumeGain.connect(audioContext.destination);
            
            volumeGain.gain.setValueAtTime(0.0, audioContext.currentTime);

            document.getElementById('alternar-audio').addEventListener('click', toggleAudio);
        }

        function toggleAudio() {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            const audioButton = document.getElementById('alternar-audio');

            if (isAudioPlaying) {
                volumeGain.gain.linearRampToValueAtTime(0.0, audioContext.currentTime + 1.0);
                setTimeout(() => {
                    audio.pause();
                }, 1000);
                audioButton.textContent = 'OFF';
            } else {
                audio.play();
                volumeGain.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 2.0); 
                audioButton.textContent = 'ON';
            }
            isAudioPlaying = !isAudioPlaying;
        }

        // --- EFECTOS E INTERACTIVIDAD ---

        function crearCorazonCSS(x, y) {
            const corazon = document.createElement('div');
            corazon.classList.add('corazon');
            corazon.innerHTML = 'üíñ'; 
            
            corazon.style.left = `${x}px`;
            corazon.style.top = `${y}px`;
            
            const duracion = Math.random() * 3 + 4; 
            corazon.style.animationDuration = `${duracion}s`;
            
            document.getElementById('superposicion-ui').appendChild(corazon);
            
            setTimeout(() => {
                corazon.remove();
            }, duracion * 1000);
        }

        function mostrarIndicadorToque(x, y) {
            const indicador = document.getElementById('indicador-toque');
            indicador.style.left = `${x}px`;
            indicador.style.top = `${y}px`;
            
            indicador.style.opacity = '1';
            indicador.style.transition = 'opacity 0.2s';
            setTimeout(() => {
                indicador.style.opacity = '0';
                indicador.style.transition = 'opacity 1s';
            }, 200);
        }

        function onPointerDown(event) {
            if (!isLoaded) return;
            
            event.preventDefault();

            // Usar clientX/Y para clics y el primer toque para m√≥viles
            const x = event.clientX || (event.touches && event.touches[0] ? event.touches[0].clientX : null);
            const y = event.clientY || (event.touches && event.touches[0] ? event.touches[0].clientY : null);

            if (x === null || y === null) return; // Salir si la posici√≥n no es v√°lida

            // 1. Efectos CSS (Coraz√≥n y Toque)
            crearCorazonCSS(x, y);
            mostrarIndicadorToque(x, y);

            // 2. Activaci√≥n de Audio (si es la primera interacci√≥n)
            if (!isAudioPlaying && audio && audioContext) {
                toggleAudio();
                // Ocultar instrucciones
                document.getElementById('instrucciones').style.opacity = '0';
                document.getElementById('instrucciones').style.pointerEvents = 'none';
            }
            
            // 3. Interacci√≥n con el texto 3D
            mouse.x = (x / window.innerWidth) * 2 - 1;
            mouse.y = - (y / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(scene.children, true);

            for (let i = 0; i < intersects.length; i++) {
                if (intersects[i].object.userData.isClickableText) {
                    texto3D.rotation.y += Math.PI / 18;
                    controls.autoRotate = false; 
                    setTimeout(() => { controls.autoRotate = true; }, 5000); 
                    break;
                }
            }
            
            // Detener temporalmente la rotaci√≥n autom√°tica para permitir arrastrar
            controls.autoRotate = false;
        }

        // --- GALER√çA Y MODAL ---

        function setupGallery() {
            const elementosGaleria = document.querySelectorAll('.elemento-galeria');
            const modal = document.getElementById('modal-imagen');
            const imagenModal = document.getElementById('imagen-modal');
            const mensajeModal = document.getElementById('mensaje-modal');
            const botonCerrar = document.querySelector('.boton-cerrar');

            elementosGaleria.forEach(elemento => {
                elemento.addEventListener('click', (event) => {
                    event.preventDefault();
                    event.stopPropagation(); // Evitar que el clic en la miniatura active el coraz√≥n

                    const indice = elemento.getAttribute('data-indice');
                    const imgSrc = elemento.querySelector('img').src;

                    // Llenar el modal
                    imagenModal.src = imgSrc;
                    mensajeModal.textContent = CONFIG.mensajesGaleria[indice] || "Un recuerdo especial de nuestro viaje.";

                    // Mostrar el modal
                    modal.style.display = 'flex';
                });
            });

            // Cerrar el modal al hacer clic en la X
            botonCerrar.addEventListener('click', () => {
                modal.style.display = 'none';
            });

            // Cerrar el modal al hacer clic fuera de la imagen (en el fondo oscuro)
            modal.addEventListener('click', (event) => {
                // Verificar si el clic fue directamente en el div.modal (fondo) y no en el contenido
                if (event.target === modal || event.target.className === 'contenido-modal-contenedor') {
                    modal.style.display = 'none';
                }
            });
        }

        // --- EVENTOS Y AJUSTES FINALES ---

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function setupEventListeners() {
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('pointerdown', onPointerDown); 
            window.addEventListener('touchstart', onPointerDown, { passive: false }); 
            setupGallery(); 
        }

        // --- INICIO DE LA APLICACI√ìN ---

        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                setupAudio();
                init();
            }, 100);
        });
    </script>
</body>
</html>
